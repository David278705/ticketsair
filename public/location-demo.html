<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test LocationSelector Component</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        .success { 
            background-color: #d4edda; 
            border-color: #c3e6cb; 
            color: #155724;
        }
        .error { 
            background-color: #f8d7da; 
            border-color: #f5c6cb; 
            color: #721c24;
        }
        .loading { 
            background-color: #fff3cd; 
            border-color: #ffeaa7; 
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        h1 { color: #333; text-align: center; }
        h3 { margin: 0 0 10px 0; }
        ul { margin: 10px 0; padding-left: 20px; }
        .demo-selector {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        select, input {
            width: 100%;
            padding: 8px 12px;
            margin: 5px 0 15px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 10px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Test del Sistema de Ubicaciones</h1>
        
        <div id="app">
            <!-- Test de pa√≠ses -->
            <div id="countries-test" class="test-result loading">
                <h3>üìç Test 1: Carga de Pa√≠ses</h3>
                <p>Cargando pa√≠ses desde REST Countries API...</p>
            </div>

            <!-- Test de estados -->
            <div id="states-test" class="test-result info">
                <h3>üèôÔ∏è Test 2: Estados/Regiones</h3>
                <p>Esperando selecci√≥n de pa√≠s para probar estados...</p>
            </div>

            <!-- Demo interactivo -->
            <div class="demo-selector">
                <h3>üöÄ Demo Interactivo del Selector</h3>
                
                <label for="demo-country">Pa√≠s:</label>
                <select id="demo-country" v-model="selectedCountry" @change="loadStatesDemo">
                    <option value="">Selecciona un pa√≠s</option>
                    <option v-for="country in countries" :key="country.code" :value="country.code">
                        {{ country.name }}
                    </option>
                </select>

                <div v-if="selectedCountry">
                    <label for="demo-state">Estado/Regi√≥n:</label>
                    <select id="demo-state" v-model="selectedState" @change="loadCitiesDemo" :disabled="loadingStates">
                        <option value="">{{ loadingStates ? 'Cargando...' : 'Selecciona una regi√≥n' }}</option>
                        <option v-for="state in states" :key="state.id" :value="state.code">
                            {{ state.name }}
                        </option>
                    </select>

                    <div v-if="!states.length && !loadingStates">
                        <label for="city-search">Buscar Ciudad:</label>
                        <input 
                            id="city-search" 
                            type="text" 
                            v-model="citySearch"
                            @input="searchCities"
                            placeholder="Escribe el nombre de una ciudad..."
                        />
                        <div v-if="searchResults.length" class="result">
                            <strong>Resultados de b√∫squeda:</strong>
                            <div v-for="city in searchResults" :key="city.id" style="padding: 5px 0; border-bottom: 1px solid #ddd;">
                                üìç {{ city.name }}
                                <span v-if="city.adminName"> ({{ city.adminName }})</span>
                                <span v-if="city.population"> - {{ formatPopulation(city.population) }} hab.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="selectedState && cities.length">
                    <label for="demo-city">Ciudad:</label>
                    <select id="demo-city" v-model="selectedCity" :disabled="loadingCities">
                        <option value="">{{ loadingCities ? 'Cargando...' : 'Selecciona una ciudad' }}</option>
                        <option v-for="city in cities" :key="city.id" :value="city.id">
                            {{ city.name }} 
                            <span v-if="city.population">({{ formatPopulation(city.population) }} hab.)</span>
                        </option>
                    </select>
                </div>

                <div v-if="selectedCountry" class="result">
                    <strong>Selecci√≥n actual:</strong>
                    Pa√≠s: {{ getCountryName(selectedCountry) }}
                    <span v-if="selectedState">
                        <br>Estado: {{ getStateName(selectedState) }}
                    </span>
                    <span v-if="selectedCity">
                        <br>Ciudad: {{ getCityName(selectedCity) }}
                    </span>
                </div>
            </div>

            <!-- Informaci√≥n del sistema -->
            <div class="test-result info">
                <h3>‚ÑπÔ∏è Informaci√≥n del Sistema</h3>
                <ul>
                    <li><strong>APIs utilizadas:</strong> REST Countries (pa√≠ses), datos est√°ticos (estados/ciudades)</li>
                    <li><strong>Fallback robusto:</strong> Si las APIs fallan, usa datos locales</li>
                    <li><strong>B√∫squeda inteligente:</strong> Busca ciudades cuando no hay navegaci√≥n jer√°rquica</li>
                    <li><strong>Pa√≠ses soportados:</strong> {{ supportedCountries.join(', ') }}</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        // LocationService simplificado para el demo
        class LocationService {
            constructor() {
                this.countriesAPI = 'https://restcountries.com/v3.1'
            }

            async getCountries() {
                try {
                    const response = await axios.get(`${this.countriesAPI}/all?fields=name,cca2,cca3`)
                    return response.data
                        .filter(country => country.name && country.name.common)
                        .map(country => ({
                            code: country.cca2,
                            name: country.name.common,
                            iso3: country.cca3
                        }))
                        .sort((a, b) => a.name.localeCompare(b.name))
                } catch (error) {
                    console.error('Error fetching countries:', error)
                    return this.getFallbackCountries()
                }
            }

            getFallbackCountries() {
                return [
                    { code: 'US', name: 'Estados Unidos', iso3: 'USA' },
                    { code: 'MX', name: 'M√©xico', iso3: 'MEX' },
                    { code: 'ES', name: 'Espa√±a', iso3: 'ESP' },
                    { code: 'CO', name: 'Colombia', iso3: 'COL' },
                    { code: 'AR', name: 'Argentina', iso3: 'ARG' }
                ]
            }

            getStaticStates(countryCode) {
                const statesData = {
                    'MX': [
                        { id: 'CDMX', name: 'Ciudad de M√©xico', code: 'CDMX' },
                        { id: 'JAL', name: 'Jalisco', code: 'JAL' },
                        { id: 'NL', name: 'Nuevo Le√≥n', code: 'NL' },
                        { id: 'BC', name: 'Baja California', code: 'BC' },
                        { id: 'PUE', name: 'Puebla', code: 'PUE' }
                    ],
                    'CO': [
                        { id: 'DC', name: 'Distrito Capital (Bogot√°)', code: 'DC' },
                        { id: 'ANT', name: 'Antioquia', code: 'ANT' },
                        { id: 'VAC', name: 'Valle del Cauca', code: 'VAC' },
                        { id: 'ATL', name: 'Atl√°ntico', code: 'ATL' }
                    ],
                    'ES': [
                        { id: 'MD', name: 'Madrid', code: 'MD' },
                        { id: 'CT', name: 'Catalu√±a', code: 'CT' },
                        { id: 'AN', name: 'Andaluc√≠a', code: 'AN' },
                        { id: 'VC', name: 'Valencia', code: 'VC' }
                    ],
                    'AR': [
                        { id: 'CABA', name: 'Ciudad Aut√≥noma de Buenos Aires', code: 'CABA' },
                        { id: 'BA', name: 'Provincia de Buenos Aires', code: 'BA' },
                        { id: 'COR', name: 'C√≥rdoba', code: 'COR' },
                        { id: 'SF', name: 'Santa Fe', code: 'SF' }
                    ]
                }
                return statesData[countryCode] || []
            }

            getStaticCities(countryCode, stateCode) {
                const citiesData = {
                    'MX': {
                        'CDMX': [
                            { id: 'mx_cdmx_1', name: 'Ciudad de M√©xico', population: 9200000 }
                        ],
                        'JAL': [
                            { id: 'mx_jal_1', name: 'Guadalajara', population: 1500000 },
                            { id: 'mx_jal_2', name: 'Zapopan', population: 1400000 },
                            { id: 'mx_jal_3', name: 'Puerto Vallarta', population: 290000 }
                        ],
                        'NL': [
                            { id: 'mx_nl_1', name: 'Monterrey', population: 1140000 },
                            { id: 'mx_nl_2', name: 'Guadalupe', population: 700000 }
                        ]
                    },
                    'CO': {
                        'DC': [
                            { id: 'co_dc_1', name: 'Bogot√°', population: 7400000 }
                        ],
                        'ANT': [
                            { id: 'co_ant_1', name: 'Medell√≠n', population: 2500000 },
                            { id: 'co_ant_2', name: 'Bello', population: 500000 }
                        ]
                    },
                    'ES': {
                        'MD': [
                            { id: 'es_md_1', name: 'Madrid', population: 3200000 },
                            { id: 'es_md_2', name: 'Getafe', population: 180000 }
                        ],
                        'CT': [
                            { id: 'es_ct_1', name: 'Barcelona', population: 1600000 },
                            { id: 'es_ct_2', name: 'Terrassa', population: 220000 }
                        ]
                    }
                }
                return citiesData[countryCode]?.[stateCode] || []
            }

            async searchCities(query, countryCode) {
                // Simulaci√≥n de b√∫squeda de ciudades principales
                const allCities = [
                    { id: '1', name: 'Ciudad de M√©xico', adminName: 'Ciudad de M√©xico', population: 9200000 },
                    { id: '2', name: 'Guadalajara', adminName: 'Jalisco', population: 1500000 },
                    { id: '3', name: 'Monterrey', adminName: 'Nuevo Le√≥n', population: 1140000 },
                    { id: '4', name: 'Bogot√°', adminName: 'Distrito Capital', population: 7400000 },
                    { id: '5', name: 'Medell√≠n', adminName: 'Antioquia', population: 2500000 },
                    { id: '6', name: 'Madrid', adminName: 'Madrid', population: 3200000 },
                    { id: '7', name: 'Barcelona', adminName: 'Catalu√±a', population: 1600000 },
                    { id: '8', name: 'Buenos Aires', adminName: 'CABA', population: 2890000 }
                ]
                
                return allCities.filter(city => 
                    city.name.toLowerCase().includes(query.toLowerCase())
                )
            }
        }

        createApp({
            setup() {
                const locationService = new LocationService()
                
                const countries = ref([])
                const states = ref([])
                const cities = ref([])
                const searchResults = ref([])
                
                const selectedCountry = ref('')
                const selectedState = ref('')
                const selectedCity = ref('')
                const citySearch = ref('')
                
                const loadingStates = ref(false)
                const loadingCities = ref(false)
                
                const supportedCountries = ['M√©xico', 'Espa√±a', 'Colombia', 'Argentina', 'Estados Unidos']

                // Cargar pa√≠ses al iniciar
                const loadCountries = async () => {
                    try {
                        countries.value = await locationService.getCountries()
                        document.getElementById('countries-test').innerHTML = `
                            <h3>üìç Test 1: Carga de Pa√≠ses ‚úÖ</h3>
                            <p><strong>Pa√≠ses cargados:</strong> ${countries.value.length}</p>
                            <p><strong>Primeros 5:</strong> ${countries.value.slice(0, 5).map(c => c.name).join(', ')}</p>
                        `
                        document.getElementById('countries-test').className = 'test-result success'
                    } catch (error) {
                        document.getElementById('countries-test').innerHTML = `
                            <h3>üìç Test 1: Carga de Pa√≠ses ‚ùå</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                        `
                        document.getElementById('countries-test').className = 'test-result error'
                    }
                }

                const loadStatesDemo = async () => {
                    if (!selectedCountry.value) return
                    
                    loadingStates.value = true
                    states.value = []
                    selectedState.value = ''
                    cities.value = []
                    selectedCity.value = ''
                    
                    try {
                        states.value = locationService.getStaticStates(selectedCountry.value)
                        
                        document.getElementById('states-test').innerHTML = `
                            <h3>üèôÔ∏è Test 2: Estados/Regiones ‚úÖ</h3>
                            <p><strong>Pa√≠s seleccionado:</strong> ${getCountryName(selectedCountry.value)}</p>
                            <p><strong>Estados encontrados:</strong> ${states.value.length}</p>
                            ${states.value.length ? '<p><strong>Estados:</strong> ' + states.value.map(s => s.name).join(', ') + '</p>' : '<p><em>No hay estados disponibles - usar b√∫squeda de ciudades</em></p>'}
                        `
                        document.getElementById('states-test').className = 'test-result success'
                    } catch (error) {
                        document.getElementById('states-test').innerHTML = `
                            <h3>üèôÔ∏è Test 2: Estados/Regiones ‚ùå</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                        `
                        document.getElementById('states-test').className = 'test-result error'
                    } finally {
                        loadingStates.value = false
                    }
                }

                const loadCitiesDemo = () => {
                    if (!selectedState.value) return
                    
                    loadingCities.value = true
                    cities.value = locationService.getStaticCities(selectedCountry.value, selectedState.value)
                    loadingCities.value = false
                }

                const searchCities = async () => {
                    if (!citySearch.value || citySearch.value.length < 2) {
                        searchResults.value = []
                        return
                    }
                    
                    searchResults.value = await locationService.searchCities(citySearch.value, selectedCountry.value)
                }

                const getCountryName = (code) => {
                    const country = countries.value.find(c => c.code === code)
                    return country ? country.name : code
                }

                const getStateName = (code) => {
                    const state = states.value.find(s => s.code === code)
                    return state ? state.name : code
                }

                const getCityName = (id) => {
                    const city = cities.value.find(c => c.id === id)
                    return city ? city.name : id
                }

                const formatPopulation = (population) => {
                    if (population >= 1000000) {
                        return (population / 1000000).toFixed(1) + 'M'
                    }
                    if (population >= 1000) {
                        return (population / 1000).toFixed(0) + 'K'
                    }
                    return population.toString()
                }

                // Inicializar
                loadCountries()

                return {
                    countries,
                    states,
                    cities,
                    searchResults,
                    selectedCountry,
                    selectedState,
                    selectedCity,
                    citySearch,
                    loadingStates,
                    loadingCities,
                    supportedCountries,
                    loadStatesDemo,
                    loadCitiesDemo,
                    searchCities,
                    getCountryName,
                    getStateName,
                    getCityName,
                    formatPopulation
                }
            }
        }).mount('#app')
    </script>
</body>
</html>